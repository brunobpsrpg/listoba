<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>LISTOBA ‚Äî Cerberus v16.1</title>

  <!-- Bootstrap & Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">

  <link rel="icon" type="image/svg+xml" href="assets/favicon.svg">
  <!-- CSS externo -->
  <link rel="stylesheet" href="css/style.css">
</head>
<body>
  <div class="app-shell">
    <!-- TOP BAR -->
    <div class="bar p-2 mb-2 d-flex align-items-center justify-content-between flex-wrap gap-2">
      <div class="brand">
        <img src="assets/logo.png" alt="Cerberus logo" style="height:28px"/>
        <span>LISTOBA ‚Äî Cerberus v16.1</span>
      </div>
      <div class="d-flex flex-wrap gap-2">
        <button class="btn btn-sm btn-accent" id="btnNewTask"><i class="bi bi-plus-lg me-1"></i>Nova tarefa</button>
        <button class="btn btn-sm btn-outline-light btn-thin" id="btnClients"><i class="bi bi-people me-1"></i>Clientes</button>
        <button class="btn btn-sm btn-outline-light btn-thin" id="btnAddPerson"><i class="bi bi-person-plus me-1"></i>Pessoa</button>
        <button class="btn btn-sm btn-outline-light btn-thin" id="btnToggleCompact" title="Alternar modo normal/compacto">
          <i class="bi bi-arrows-collapse"></i>
        </button>
        <button class="btn btn-sm btn-outline-light btn-thin" id="btnToggleSummary" title="Mostrar/ocultar LISTOBA">
          <i class="bi bi-caret-up-square"></i>
        </button>
        <button class="btn btn-sm btn-outline-light btn-thin" id="btnExport"><i class="bi bi-download me-1"></i>Exportar</button>
        <label class="btn btn-sm btn-outline-light btn-thin mb-0" for="importFile"><i class="bi bi-upload me-1"></i>Importar</label>
        <input type="file" id="importFile" accept="application/json" class="d-none"/>
      </div>
    </div>

    <!-- SUMMARY / WHATS -->
    <section class="bar summary mb-3" id="summary">
      <div class="d-flex align-items-center justify-content-between flex-wrap gap-2">
        <h6 class="m-0">üìù LISTOBA (copiar pro Whats)</h6>
        <div class="d-flex align-items-center gap-2">
          <select id="summaryMode" class="form-select form-select-sm thin" style="width:250px">
            <option value="simple">Formato: Padr√£o (curto)</option>
            <option value="detailed">Formato: Detalhado (coparticipantes / descri√ß√£o / subtarefas)</option>
          </select>
          <button class="btn btn-sm btn-accent" id="btnCopy"><i class="bi bi-clipboard-check me-1"></i>Copiar</button>
        </div>
      </div>
      <div id="summaryBody" class="mt-2"></div>
      <div class="mt-2">
        <label class="form-label mb-1">üóìÔ∏è Observa√ß√µes da pr√≥xima semana</label>
        <textarea id="nextWeekNotes" class="form-control thin" rows="2" placeholder="Ex.: alinhamentos, pend√™ncias e lembretes para a pr√≥xima semana"></textarea>
        <div class="mt-2 d-flex gap-2">
          <button class="btn btn-sm btn-outline-light btn-thin" id="btnSaveNotes"><i class="bi bi-save me-1"></i>Salvar observa√ß√µes</button>
        </div>
      </div>
    </section>

    <!-- KANBAN -->
    <section class="bar kanban">
      <div class="d-flex align-items-center justify-content-between mb-1">
        <h6 class="m-0">üóÇÔ∏è Kanban por pessoa</h6>
        <div class="small footer-tip">Duplo clique no nome renomeia ‚Ä¢ arraste cart√µes (apenas do respons√°vel principal)</div>
      </div>
      <div class="columns" id="columns"></div>
    </section>

    <!-- RELAT√ìRIO: Lista em cima, filtros no rodap√© -->
    <section class="bar p-2 mt-3">
      <div class="d-flex align-items-center justify-content-between flex-wrap gap-2">
        <div class="d-flex align-items-center gap-2 flex-wrap">
          <h6 class="m-0">üìä Relat√≥rio de tarefas</h6>
          <span class="text-secondary small">Pesquisa completa (inclui conclu√≠das)</span>
        </div>
      </div>

      <!-- Lista com rolagem (‚âà 6 itens vis√≠veis) -->
      <div class="table-responsive mt-2 report-scroll" style="max-height:300px; overflow:auto; border-top:1px solid var(--line);">
        <table class="table table-sm align-middle" id="tblListoba">
          <thead>
            <tr>
              <th>Tarefa</th>
              <th>Pessoa</th>
              <th>Co-respons√°veis</th>
              <th>Cliente</th>
              <th>Tipo</th>
              <th style="width:110px">Prazo</th>
              <th style="width:120px">Status</th>
              <th style="width:160px">A√ß√µes</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>

      <!-- Filtros compactos no rodap√© -->
      <div class="mt-2">
        <!-- Linha 1: busca texto (full width) -->
        <div class="mb-2">
          <input id="search" class="form-control form-control-sm thin" placeholder="Filtrar por t√≠tulo, pessoa, cliente‚Ä¶"/>
        </div>

        <!-- Linha 2: filtros compactos em linha -->
        <div class="d-flex flex-wrap gap-2 align-items-center">
          <select id="filterStatus" class="form-select form-select-sm thin" style="width:150px">
            <option value="all">Todos status</option>
            <option value="todo">A fazer</option>
            <option value="standby">Stand-by</option>
            <option value="overdue">Atrasadas</option>
            <option value="done">Conclu√≠das</option>
          </select>

          <select id="filterPerson" class="form-select form-select-sm thin" style="width:160px"></select>
          <select id="filterClient" class="form-select form-select-sm thin" style="width:160px"></select>
          <select id="filterType" class="form-select form-select-sm thin" style="width:170px"></select>

          <!-- Datas compactas lado a lado -->
          <input type="date" id="filterFrom" class="form-control form-control-sm thin" title="De" style="width:150px"/>
          <input type="date" id="filterTo" class="form-control form-control-sm thin" title="At√©" style="width:150px"/>

          <select id="sortDate" class="form-select form-select-sm thin" title="Ordenar pela data" style="width:180px">
            <option value="asc">Data crescente</option>
            <option value="desc" selected>Data decrescente</option>
          </select>
        </div>
      </div>
    </section>

    <p class="mt-3 text-center footer-tip">Cerberus ‚Äî fino, direto e faminto por concluir.</p>
  </div>

  <!-- Modais (iguais) -->
  <div class="modal fade" id="taskModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title fw-bold" id="taskModalTitle">Nova tarefa</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <form id="taskForm" class="vstack gap-2">
            <input type="hidden" id="taskId"/>
            <div>
              <label class="form-label">T√≠tulo</label>
              <input class="form-control thin" id="taskTitle" required placeholder="Ex.: KV CPL ‚Äì fechar vers√£o final"/>
            </div>
            <div class="row g-2">
              <div class="col-4">
                <label class="form-label">Respons√°vel</label>
                <select class="form-select thin" id="taskAssignee"></select>
              </div>
              <div class="col-4">
                <label class="form-label">Co-respons√°veis</label>
                <select class="form-select thin" id="taskCoAssignees" multiple></select>
                <div class="form-text">Segure Ctrl/Cmd para selecionar v√°rios</div>
              </div>
              <div class="col-4">
                <label class="form-label">Prazo</label>
                <input type="date" class="form-control thin" id="taskDue"/>
              </div>
            </div>
            <div class="row g-2">
              <div class="col-6">
                <label class="form-label">Cliente</label>
                <select class="form-select thin" id="taskClient"></select>
              </div>
              <div class="col-6">
                <label class="form-label">Tipo</label>
                <select class="form-select thin" id="taskType">
                  <option value="üé® Cria√ß√£o">üé® Cria√ß√£o</option>
                  <option value="üîÅ Refa√ß√£o">üîÅ Refa√ß√£o</option>
                  <option value="üí∞ Or√ßamento">üí∞ Or√ßamento</option>
                  <option value="‚úèÔ∏è Altera√ß√£o">‚úèÔ∏è Altera√ß√£o</option>
                  <option value="üé§ Apresenta√ß√£o">üé§ Apresenta√ß√£o</option>
                  <option value="üß© Outros">üß© Outros</option>
                </select>
              </div>
            </div>
            <div class="row g-2">
              <div class="col-6">
                <label class="form-label">Status</label>
                <select class="form-select thin" id="taskStatus">
                  <option value="todo">A fazer</option>
                  <option value="standby">Stand-by</option>
                  <option value="done">Conclu√≠do</option>
                </select>
              </div>
            </div>
            <div>
              <label class="form-label">Subtarefas</label>
              <div id="subtasks" class="vstack gap-2"></div>
              <button class="btn btn-sm btn-outline-light mt-2 btn-thin" id="btnAddSub" type="button"><i class="bi bi-plus"></i> adicionar sub-tarefa</button>
            </div>
            <div>
              <label class="form-label">Notas (opcional)</label>
              <textarea class="form-control thin" rows="3" id="taskNotes" placeholder="Observa√ß√µes r√°pidas, links, etc."></textarea>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button class="btn btn-outline-light btn-thin" data-bs-dismiss="modal">Cancelar</button>
          <button class="btn btn-accent btn-thin" id="btnSaveTask" type="button">Salvar</button>
        </div>
      </div>
    </div>
  </div>

  <div class="modal fade" id="viewModal" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Detalhes da tarefa</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body" id="viewBody"></div>
        <div class="modal-footer">
          <button class="btn btn-outline-light btn-thin" data-bs-dismiss="modal">Fechar</button>
          <button class="btn btn-outline-success btn-thin" id="btnToggleDoneView">Concluir/Reabrir</button>
          <button class="btn btn-accent btn-thin" id="btnEditFromView">Editar</button>
        </div>
      </div>
    </div>
  </div>

  <div class="modal fade" id="clientsModal" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Clientes</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <div class="input-group mb-2">
            <input id="newClientName" class="form-control thin" placeholder="Nome do cliente"/>
            <button class="btn btn-accent btn-thin" id="btnAddClient" type="button"><i class="bi bi-plus"></i> Adicionar</button>
          </div>
          <ul id="clientsList" class="list-group"></ul>
        </div>
      </div>
    </div>
  </div>

  <!-- Bootstrap Bundle + JS do app -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="js/app.js"></script>
</body>
</html>
